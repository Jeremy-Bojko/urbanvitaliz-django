{% load static %}
<!-- resources -->
<div id="resource-list"
     class="push-reco__ressources fr-mb-3w grow container-fluid"
     x-show="push_type != 'noresource'"
     x-transition:enter-start="grow-enter-start"
     x-transition:leave="grow-leave">
    <h3 class="push-reco__title-section">Recherche d'une ressource existante sur {{ request.site.name }}</h3>
    <div class="row g-0">
        <div class="ressources__search-bar col-12">
            <span class="fr-icon-search-line fr-icon--sm" aria-hidden="true"></span>
            <input data-test-id="search-resource-input"
                   class="fr-input w-100"
                   type="search"
                   x-on:input.debounce="searchResources()"
                   x-model="search"
                   placeholder="Rechercher une ressource...">
        </div>
    </div>
    {% for error in form.resource.errors %}<div class="text-danger text-start fr-mb-2v">{{ error }}</div>{% endfor %}
    <!-- listing -->
    <p class="search-counter fs-6 fr-mb-0"
       x-show="!search"
       x-text="`${db.documentCount} ressources au total`"></p>
    <p class="search-counter fs-6 fr-mb-0"
       x-show="search"
       x-text="`${results.length} ressource(s) trouvée(s)`"></p>
    <ul x-show="results.length > 0"
        class="cards d-flex row row-cols-3 g-4 fr-pl-0 fr-ml-0 fr-mt-1v">
        <template x-for="resource in results" :key="resource.id">
            <li class="col-4">
                <div class="ressources__result-item fr-radio-group fr-radio-rich">
                    <input type="radio"
                           :value="resource.id"
                           :id="'resource-' + resource.id"
                           name="resource"
                           x-model="selected_resource"
                           @click="setIntent(resource)">
                    <label class="fr-label" :for="'resource-' + resource.id">
                        <span class="ressources__result-item-title" x-text="resource.title"></span>
                        <span class="ressources__result-item-subtitle fr-hint-text"
                              x-text="resource.subtitle"></span>
                        <div>
                            <ul class="fr-badge-group fr-p-0">
                                <template x-if="resource.category && resource.category.name">
                                    <li>
                                        <span class="fr-badge fr-badge--sm fr-badge--green-menthe"
                                              x-text="resource.category.name"></span>
                                    </li>
                                </template>
                                <li x-show="resource.is_dsresource">
                                    <span class="fr-badge fr-badge--sm text-transform-none">
                                        <img height="8px"
                                             width="18px"
                                             src="{% static 'svg/picto-demarches_simplifiees--no-border.svg' %}"
                                             alt="Pictogramme Démarches Simpliffiées"
                                             class="fr-pr-1v">
                                    Démarches Simplifiées</span>
                                </li>
                            </ul>
                        </div>
                        <button @click.prevent
                                data-bs-toggle="modal"
                                :data-bs-target="`#resource-preview-`+resource.id"
                                class="fr-btn fr-btn--tertiary-no-outline fr-btn--icon-left fr-icon-eye-line">
                            Prévisualiser
                        </button>
                    </label>
                    <!-- Full screen modal -->
                    <div class="modal fade"
                         :id="`resource-preview-`+resource.id"
                         tabindex="-1"
                         :aria-labelledby="`resource-preview-`+resource.id"
                         aria-hidden="true">
                        <div class="modal-dialog modal-fullscreen">
                            <div class="modal-content">
                                <div class="modal-header justify-content-between">
                                    <h5 class="modal-title">Prévisualisation de la ressource</h5>
                                    <button type="button"
                                            class="fr-btn fr-btn-close"
                                            data-bs-dismiss="modal"
                                            aria-label="Close">Fermer</button>
                                </div>
                                <div class="modal-body">
                                    <iframe class="w-100 h-100" :src="resource.url_embeded"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </template>
    </ul>
    <div x-show="results.length <= 0 && search != ''"
         class="fr-p-2w w-100 text-center rounded bg-light">
        <span class="fw-bolder">Aucune ressource correspondante</span>
        <div x-show="suggestions.length">
            Vous cherchez peut être : <template x-for="suggestion in suggestions">
            <a href="#"
               @click.prevent="search = suggestion.suggestion; searchResources();"
               x-text="suggestion.suggestion"></a>&nbsp;
        </template>
    </div>
</div>
</div>
